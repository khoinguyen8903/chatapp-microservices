<!-- Premium Sidebar Header -->
<header class="sidebar-header">
  <div class="header-top">
    <div class="app-branding">
      <div class="brand-icon">
        <i class="fas fa-comment-dots"></i>
      </div>
      <h1 class="brand-title">Messages</h1>
    </div>

    <div class="header-actions">
      <button 
        (click)="openCreateGroupModal()"
        class="action-btn"
        title="Create New Group"
        aria-label="Create group">
        <i class="fas fa-users-cog"></i>
      </button>

      <button 
        (click)="goToProfile()"
        class="action-btn"
        title="My Profile"
        aria-label="View profile">
        <i class="fas fa-user-circle"></i>
      </button>
    </div>
  </div>

  <!-- User Info Badge -->
  <div class="current-user-badge">
    <div class="user-avatar">
      {{ (facade.currentUser()?.username || 'U').charAt(0) | uppercase }}
    </div>
    <span class="user-name">{{ facade.currentUser()?.username || 'Guest' }}</span>
    <span class="online-dot"></span>
  </div>
</header>

<!-- Search Section with Modern Styling -->
<section class="search-section">
  <div class="search-wrapper">
    <i class="fas fa-search search-icon"></i>
    <input
      type="text"
      [(ngModel)]="userToChat"
      (keyup.enter)="startNewChat()"
      placeholder="Search for people..."
      class="search-input"
      aria-label="Search users"
    >
    @if (userToChat) {
      <button
        (click)="startNewChat()"
        class="search-action-btn"
        title="Start chat"
        aria-label="Start new chat">
        <i class="fas fa-paper-plane"></i>
      </button>
    }
  </div>
</section>

<!-- Conversations List -->
<nav class="conversations-list custom-scrollbar" role="navigation" aria-label="Conversations">
  @if (facade.sessions().length === 0) {
    <div class="empty-state animate-fade-in">
      <div class="empty-icon-wrapper">
        <i class="fas fa-inbox"></i>
      </div>
      <h3 class="empty-title">No conversations yet</h3>
      <p class="empty-subtitle">Search for friends or create a group to get started!</p>
    </div>
  }

  @for (session of facade.sessions(); track session.id) {
    <article
      (click)="facade.selectSession(session)"
      class="conversation-card"
      [class.active]="facade.selectedSession()?.id === session.id"
      role="button"
      tabindex="0"
      [attr.aria-label]="'Chat with ' + session.name">

      <!-- Avatar with Status -->
      <div class="avatar-wrapper">
        <div 
          class="avatar"
          [class.group-avatar]="session.type === 'GROUP'"
          [class.private-avatar]="session.type === 'PRIVATE'">
          
          @if (session.type === 'GROUP') {
            <i class="fas fa-users"></i>
          } @else {
            <span class="avatar-initial">{{ (session.name || '?').charAt(0) | uppercase }}</span>
          }
        </div>

        <!-- Online Status Indicator -->
        @if (session.type === 'PRIVATE' && session.status === 'ONLINE') {
          <span class="online-indicator" title="Online"></span>
        }
      </div>

      <!-- Conversation Info -->
      <div class="conversation-content">
        <div class="conversation-top">
          <h3 class="conversation-name text-truncate" 
              [class.unread]="session.unreadCount > 0">
            {{ session.name }}
          </h3>
          
          <!-- Unread Badge -->
          @if (session.unreadCount > 0) {
            <span class="unread-badge">
              {{ session.unreadCount > 9 ? '9+' : session.unreadCount }}
            </span>
          }
        </div>

        <div class="conversation-bottom">
          @if (session.lastMessage) {
            <span class="conversation-meta last-message text-truncate" 
                  [class.unread]="session.unreadCount > 0">
              {{ session.lastMessage }}
            </span>
          } @else {
            @if (session.type === 'GROUP') {
              <i class="fas fa-user-friends meta-icon"></i>
              <span class="conversation-meta text-truncate">
                {{ session.memberCount || 0 }} members
              </span>
            } @else {
              <i class="fas fa-circle meta-icon" 
                 [class.online-dot]="session.status === 'ONLINE'"
                 [class.offline-dot]="session.status !== 'ONLINE'"></i>
              <span class="conversation-meta text-truncate">
                {{ session.status === 'ONLINE' ? 'Active now' : 'Tap to chat' }}
              </span>
            }
          }
        </div>
      </div>

      <!-- Active Indicator Border -->
      <div class="active-border"></div>
    </article>
  }
</nav>

<!-- Group Modal -->
@if (showCreateGroupModal()) {
  <app-create-group-modal (onClose)="showCreateGroupModal.set(false)"></app-create-group-modal>
}