<div class="friends-container">
  <!-- Header -->
  <header class="friends-header">
    <div class="header-content">
      <h1 class="header-title">ğŸ‘¥ Báº¡n BÃ¨</h1>
      <div class="header-stats">
        <span class="stat-badge">{{ totalFriends }} báº¡n bÃ¨</span>
        <span *ngIf="pendingRequestsCount > 0" class="stat-badge badge-warning">
          {{ pendingRequestsCount }} lá»i má»i má»›i
        </span>
      </div>
    </div>

    <!-- Search Box -->
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="searchKeyword"
        placeholder="TÃ¬m kiáº¿m báº¡n bÃ¨..."
        class="search-input"
      />
      <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    </div>
  </header>

  <!-- Tabs -->
  <div class="friends-tabs">
    <button
      class="tab"
      [class.active]="activeTab === 'friends'"
      (click)="onTabChange('friends')"
    >
      <span class="tab-icon">ğŸ‘¥</span>
      <span class="tab-text">Danh SÃ¡ch Báº¡n BÃ¨</span>
    </button>

    <button
      class="tab"
      [class.active]="activeTab === 'requests'"
      (click)="onTabChange('requests')"
    >
      <span class="tab-icon">ğŸ“¨</span>
      <span class="tab-text">Lá»i Má»i</span>
      <span *ngIf="pendingRequestsCount > 0" class="badge">
        {{ pendingRequestsCount }}
      </span>
    </button>

    <button
      class="tab"
      [class.active]="activeTab === 'find'"
      (click)="onTabChange('find')"
    >
      <span class="tab-icon">ğŸ”</span>
      <span class="tab-text">TÃ¬m Báº¡n</span>
    </button>

    <button
      class="tab"
      [class.active]="activeTab === 'blocked'"
      (click)="onTabChange('blocked')"
    >
      <span class="tab-icon">ğŸš«</span>
      <span class="tab-text">ÄÃ£ Cháº·n</span>
    </button>
  </div>

  <!-- Content Area -->
  <div class="friends-content">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Äang táº£i...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-state">
      <span class="error-icon">âš ï¸</span>
      <p>{{ error }}</p>
      <button class="btn-retry" (click)="loadData()">Thá»­ láº¡i</button>
    </div>

    <!-- Friends List Tab -->
    <div *ngIf="activeTab === 'friends' && !loading && !error" class="tab-content">
      <div *ngIf="friends.length === 0" class="empty-state">
        <span class="empty-icon">ğŸ‘¥</span>
        <h3>ChÆ°a cÃ³ báº¡n bÃ¨</h3>
        <p>Báº¯t Ä‘áº§u káº¿t báº¡n Ä‘á»ƒ trÃ² chuyá»‡n vÃ  chia sáº»!</p>
        <button class="btn-primary" (click)="onTabChange('find')">
          <span class="btn-icon">ğŸ”</span>
          TÃ¬m báº¡n má»›i
        </button>
      </div>

      <div *ngIf="friends.length > 0" class="friends-grid">
        <div
          *ngFor="let friend of friends"
          class="friend-card"
        >
          <div class="friend-avatar">
            <img
              [src]="getAvatarUrl(friend.friendAvatarUrl)"
              [alt]="friend.friendFullName"
              class="avatar-image"
            />
          </div>

          <div class="friend-info">
            <h3 class="friend-name">{{ friend.friendFullName || friend.friendUsername }}</h3>
            <p class="friend-username">@{{ friend.friendUsername }}</p>
            <p class="friend-status">
              <span class="status-dot"></span>
              {{ getStatusText(friend.status) }}
            </p>
            <p class="friend-since">Káº¿t báº¡n tá»«: {{ formatDate(friend.createdAt) }}</p>
          </div>

          <div class="friend-actions">
            <button class="btn-chat" (click)="openChat(friend.friendId)" title="Nháº¯n tin">
              <span class="btn-icon">ğŸ’¬</span>
            </button>
            <button
              class="btn-profile"
              (click)="viewProfile(friend.friendId)"
              title="Xem há»“ sÆ¡"
            >
              <span class="btn-icon">ğŸ‘¤</span>
            </button>
            <button
              class="btn-block"
              (click)="blockUser(friend.friendId, friend.friendUsername)"
              title="Cháº·n ngÆ°á»i dÃ¹ng"
            >
              <span class="btn-icon">ğŸš«</span>
            </button>
            <button
              class="btn-unfriend"
              (click)="unfriend(friend.friendId)"
              title="Há»§y káº¿t báº¡n"
            >
              <span class="btn-icon">ğŸ—‘ï¸</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Friend Requests Tab -->
    <div *ngIf="activeTab === 'requests' && !loading && !error" class="tab-content">
      <div class="requests-section">
        <h3 class="section-title">Lá»i má»i Ä‘Ã£ nháº­n ({{ receivedRequests.length }})</h3>

        <div *ngIf="receivedRequests.length === 0" class="empty-state small">
          <span class="empty-icon">ğŸ“­</span>
          <p>KhÃ´ng cÃ³ lá»i má»i nÃ o</p>
        </div>

        <div *ngIf="receivedRequests.length > 0" class="requests-list">
          <div
            *ngFor="let request of receivedRequests"
            class="request-card"
          >
            <div class="request-avatar">
              <img
                [src]="getAvatarUrl(request.senderAvatarUrl)"
                [alt]="request.senderFullName"
                class="avatar-image"
              />
            </div>

            <div class="request-info">
              <h3 class="request-name">{{ request.senderFullName || request.senderUsername }}</h3>
              <p class="request-username">@{{ request.senderUsername }}</p>
              <p *ngIf="request.message" class="request-message">"{{ request.message }}"</p>
              <p class="request-date">{{ formatDate(request.createdAt) }}</p>
            </div>

            <div class="request-actions">
              <button
                class="btn-accept"
                (click)="acceptRequest(request.id)"
                title="Cháº¥p nháº­n"
              >
                <span class="btn-icon">âœ…</span>
                Cháº¥p nháº­n
              </button>
              <button
                class="btn-reject"
                (click)="rejectRequest(request.id)"
                title="Tá»« chá»‘i"
              >
                <span class="btn-icon">âŒ</span>
                Tá»« chá»‘i
              </button>
              <button
                class="btn-profile"
                (click)="viewProfile(request.senderId)"
                title="Xem há»“ sÆ¡"
              >
                <span class="btn-icon">ğŸ‘¤</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="requests-section">
        <h3 class="section-title">Lá»i má»i Ä‘Ã£ gá»­i ({{ sentRequests.length }})</h3>

        <div *ngIf="sentRequests.length === 0" class="empty-state small">
          <span class="empty-icon">ğŸ“¤</span>
          <p>ChÆ°a gá»­i lá»i má»i nÃ o</p>
        </div>

        <div *ngIf="sentRequests.length > 0" class="requests-list">
          <div
            *ngFor="let request of sentRequests"
            class="request-card sent"
          >
            <div class="request-avatar">
              <img
                [src]="getAvatarUrl(request.receiverUsername ? '/assets/default-avatar.svg' : null)"
                [alt]="request.receiverFullName"
                class="avatar-image"
              />
            </div>

            <div class="request-info">
              <h3 class="request-name">{{ request.receiverFullName || request.receiverUsername }}</h3>
              <p class="request-username">@{{ request.receiverUsername }}</p>
              <p *ngIf="request.message" class="request-message">"{{ request.message }}"</p>
              <p class="request-date">{{ formatDate(request.createdAt) }}</p>
            </div>

            <div class="request-actions">
              <button
                class="btn-cancel"
                (click)="cancelRequest(request.id)"
                title="Há»§y lá»i má»i"
              >
                <span class="btn-icon">âŒ</span>
                Há»§y
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Find Friends Tab -->
    <div *ngIf="activeTab === 'find' && !loading && !error" class="tab-content">
      <app-find-friends></app-find-friends>
    </div>

    <!-- Blocked Users Tab -->
    <div *ngIf="activeTab === 'blocked' && !loading && !error" class="tab-content">
      <div *ngIf="blockedUsers.length === 0" class="empty-state">
        <span class="empty-icon">ğŸ”“</span>
        <h3>KhÃ´ng cÃ³ ngÆ°á»i dÃ¹ng bá»‹ cháº·n</h3>
        <p>Danh sÃ¡ch cháº·n cá»§a báº¡n Ä‘ang trá»‘ng.</p>
      </div>

      <div *ngIf="blockedUsers.length > 0" class="blocked-list">
        <div
          *ngFor="let blockedUser of blockedUsers"
          class="blocked-card"
        >
          <div class="blocked-avatar">
            <img
              [src]="getAvatarUrl(blockedUser.blockedAvatarUrl)"
              [alt]="blockedUser.blockedFullName"
              class="avatar-image grayscale"
            />
          </div>

          <div class="blocked-info">
            <h3 class="blocked-name">{{ blockedUser.blockedFullName || blockedUser.blockedUsername }}</h3>
            <p class="blocked-username">@{{ blockedUser.blockedUsername }}</p>
            <p *ngIf="blockedUser.reason" class="blocked-reason">
              <span class="reason-label">LÃ½ do:</span> {{ blockedUser.reason }}
            </p>
            <p class="blocked-since">ÄÃ£ cháº·n tá»«: {{ formatDate(blockedUser.createdAt) }}</p>
          </div>

          <div class="blocked-actions">
            <button
              class="btn-unblock"
              (click)="unblockUser(blockedUser.blockedUserId)"
              title="Bá» cháº·n"
            >
              <span class="btn-icon">ğŸ”“</span>
              Bá» cháº·n
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

